var app = require("./app.js");
module.exports.ate = {
    main: {}
};
global.Template={
main:{}
};
var Generate_template=function(data_file,Template,path){
    var data=data_file;
// regex match the tag template in ejs folder 
var regex = new RegExp("\s*<template>(((.*?(\n))+)?.*?)</template>", "g");
// regex1 find tags which called 
var regex1 = new RegExp("{{>Template.([A-Z]{1}[a-zA-z0-9_]+)}}", "g");
var Find_Template = data.match(regex1);
var global_template = regex.exec(data);
if (global_template != null) {
    var data_template = global_template[1];
    while (Find_Template != null) {
        for (var index = 0; index < Find_Template.length; index++) {
            var z = Find_Template[index].substring(12, Find_Template[index].length - 2);
            var reg = new RegExp("\s*<" + z + ">(((.*?(\n))+)?.*?)</" + z + ">", "g");
            var match = reg.exec(data_template);
            if (Template.main[z] != null) {
                var keys = Object.keys(Template.main[z]);
                for (var a = 0; a < keys.length; a++) {
                                var Re1 = new RegExp("({{.*[\\s*!&><=\\*\\+\\-\\.\(])"+keys[a]+"(([\s*!&><=\\*\\+\\-\\.\)\}\}].*)?}})", "g");


                    match[1] = match[1].replace(Re1, "$1Template.main." + z + "." + keys[a]+"$2");
                }
            }
            var reg_re = new RegExp("{{>Template." + z + "}}");
            data = data.replace(reg_re, match[1]);
        }
        Find_Template = data.match(regex1);
    }
}
data = data.replace(regex, "");
var key = Object.keys(Template.main);
if (key != null) {
    for (var ind = 0; ind < key.length; ind++) {
        var temp = key[ind];
        if (/[a-z]/.test(temp[0])) {
              var Re1 = new RegExp("({{.*[\\s*!&><=\\*\\+\\-\\.\(])\\$"+temp+"(([\s*!&><=\\*\\+\\-\\.\)\}\}\[].*)?}})", "g");
            data = data.replace(Re1, "$1Template.main."+temp+"$2");
        }
    }
}
data = data.replace(/{{/g, '<%');
data = data.replace(/}}/g, '%>');
var data_html = app.render(data, Template, {
    filename: path
});
data_html = data_html.replace(/^\s*$[\n\r]{1,}/gm, '');
data_html = data_html.trim();
return data_html;
}
module.exports.makeview=function(date_file,template_data,path){
      var data_x= Generate_template(date_file,template_data,path);

return data_x;
};

